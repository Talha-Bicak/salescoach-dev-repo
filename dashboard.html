<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒ∞K√áO Dashboard - Satƒ±≈ü Eƒüitim Platformu</title>
  <link rel="stylesheet" href="/src/style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.6s ease-out;
    }
    .animate-slideIn {
      animation: slideIn 0.5s ease-out;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .stat-card {
      background: white;
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Modern Navigation -->
  <nav class="gradient-bg shadow-xl">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-20">
        <div class="flex items-center">
          <div class="flex items-center space-x-3">
            <div class="bg-white p-2 rounded-lg">
              <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <h1 class="text-2xl font-bold text-white">Satƒ±≈ü Eƒüitim Platformu</h1>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <div class="hidden md:flex items-center space-x-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            <span class="text-white font-semibold" id="user-name"></span>
          </div>
          <button onclick="logout()" class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white px-6 py-2.5 rounded-full font-semibold transition-all flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            <span>√áƒ±kƒ±≈ü</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Welcome Section -->
    <div class="mb-10 animate-fadeIn">
      <h2 class="text-4xl font-bold text-gray-800 mb-3">Ho≈ü Geldiniz! üëã</h2>
      <p class="text-xl text-gray-600">Satƒ±≈ü becerilerinizi geli≈ütirmek i√ßin yeni bir g√∂r√º≈üme ba≈ülatƒ±n</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10 animate-slideIn">
      <div class="stat-card rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wide">Toplam G√∂r√º≈üme</p>
            <p class="text-4xl font-bold text-blue-600" id="total-sessions">0</p>
            <p class="text-sm text-gray-400 mt-2">Tamamlanan oturumlar</p>
          </div>
          <div class="bg-gradient-to-br from-blue-400 to-blue-600 p-4 rounded-2xl shadow-lg">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="stat-card rounded-2xl shadow-lg p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wide">Deƒüerlendirmeler</p>
            <p class="text-4xl font-bold text-green-600" id="total-evaluations">0</p>
            <p class="text-sm text-gray-400 mt-2">AI deƒüerlendirmesi</p>
          </div>
          <div class="bg-gradient-to-br from-green-400 to-green-600 p-4 rounded-2xl shadow-lg">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="stat-card rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wide">Ortalama Skor</p>
            <p class="text-4xl font-bold text-purple-600" id="average-score">-</p>
            <p class="text-sm text-gray-400 mt-2">Performans ortalamasƒ±</p>
          </div>
          <div class="bg-gradient-to-br from-purple-400 to-purple-600 p-4 rounded-2xl shadow-lg">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Call to Action -->
    <div class="gradient-bg rounded-3xl shadow-2xl p-10 mb-10 text-white animate-fadeIn">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="mb-6 md:mb-0">
          <h3 class="text-3xl font-bold mb-3">Yeni G√∂r√º≈üme Ba≈ülat</h3>
          <p class="text-lg text-purple-100 mb-4">AI m√º≈üteri ile ger√ßek√ßi bir satƒ±≈ü g√∂r√º≈ümesi yaparak becerilerinizi geli≈ütirin</p>
          <div class="flex items-center space-x-2 text-purple-100">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>Ger√ßek zamanlƒ± sesli g√∂r√º≈üme</span>
          </div>
          <div class="flex items-center space-x-2 text-purple-100 mt-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>Detaylƒ± AI deƒüerlendirmesi</span>
          </div>
        </div>
        <a href="/index.html" class="bg-white text-purple-600 px-10 py-4 rounded-full font-bold text-lg hover:bg-purple-50 transition-all transform hover:scale-105 shadow-xl flex items-center space-x-3">
          <span>G√∂r√º≈ümeye Ba≈üla</span>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
          </svg>
        </a>
      </div>
    </div>

    <!-- Session History -->
    <div class="bg-white rounded-2xl shadow-lg p-8 animate-slideIn">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
          <svg class="w-7 h-7 mr-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          G√∂r√º≈üme Ge√ßmi≈üi
        </h3>
      </div>
      <div id="sessions-list" class="space-y-4">
        <p class="text-gray-500">Y√ºkleniyor...</p>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000';
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user') || '{}');

    if (!token || !user.id) {
      window.location.href = '/login.html';
    }

    document.getElementById('user-name').textContent = user.name;

    async function loadDashboard() {
      try {
        const response = await fetch(`${API_URL}/api/sessions`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!response.ok) throw new Error('Failed to load sessions');

        const data = await response.json();
        const sessions = data.sessions || [];

        document.getElementById('total-sessions').textContent = sessions.length;
        
        const totalEvals = sessions.reduce((sum, s) => sum + (s.evaluations?.length || 0), 0);
        document.getElementById('total-evaluations').textContent = totalEvals;

        const scores = sessions.flatMap(s => s.evaluations || []).map(e => e.score).filter(s => s !== null);
        if (scores.length > 0) {
          const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
          document.getElementById('average-score').textContent = avgScore.toFixed(1);
        }

        const sessionsList = document.getElementById('sessions-list');
        if (sessions.length === 0) {
          sessionsList.innerHTML = `
            <div class="text-center py-12">
              <svg class="w-20 h-20 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
              </svg>
              <p class="text-gray-500 text-lg">Hen√ºz g√∂r√º≈üme bulunmuyor</p>
              <p class="text-gray-400 mt-2">ƒ∞lk g√∂r√º≈ümenizi ba≈ülatmak i√ßin yukarƒ±daki butona tƒ±klayƒ±n</p>
            </div>
          `;
        } else {
          sessionsList.innerHTML = sessions.map(session => {
            const date = new Date(session.startedAt).toLocaleDateString('tr-TR');
            const time = new Date(session.startedAt).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            const duration = session.endedAt ? Math.round((new Date(session.endedAt) - new Date(session.startedAt)) / 1000 / 60) : '-';
            const hasEval = session.evaluations?.length > 0;
            
            return `
              <div class="border-2 border-gray-100 rounded-xl p-5 hover:border-purple-300 hover:shadow-lg transition-all cursor-pointer group" onclick="viewSession('${session.id}')">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-br from-purple-400 to-purple-600 p-2 rounded-lg">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-bold text-gray-800 group-hover:text-purple-600 transition-colors">${date} - ${time}</p>
                      <div class="flex items-center space-x-3 mt-1">
                        <span class="text-sm text-gray-500 flex items-center">
                          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          ${duration} dakika
                        </span>
                        <span class="text-sm text-gray-500 flex items-center">
                          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                          </svg>
                          ${session.transcripts?.length || 0} mesaj
                        </span>
                      </div>
                    </div>
                  </div>
                  ${hasEval ? 
                    '<span class="bg-gradient-to-r from-green-400 to-green-600 text-white text-sm px-4 py-1.5 rounded-full font-semibold shadow-md">‚úì Deƒüerlendirildi</span>' : 
                    '<span class="bg-gray-100 text-gray-600 text-sm px-4 py-1.5 rounded-full font-semibold">Deƒüerlendirilmedi</span>'
                  }
                </div>
              </div>
            `;
          }).join('');
        }
      } catch (error) {
        console.error('Dashboard load error:', error);
        document.getElementById('sessions-list').innerHTML = '<p class="text-red-500">Veriler y√ºklenirken hata olu≈ütu</p>';
      }
    }

    function viewSession(sessionId) {
      window.location.href = `/session.html?id=${sessionId}`;
    }

    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = '/login.html';
    }

    loadDashboard();
  </script>
</body>
</html>
